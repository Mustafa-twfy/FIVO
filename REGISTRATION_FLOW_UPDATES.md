# تحديثات تدفق التسجيل وتسجيل الدخول

## التعديلات المنجزة

### 1. تدفق التسجيل النهائي

#### للسائق (DriverRegistrationScreen → DriverDocumentsScreen → DriverVehicleScreen):
- ✅ بعد إدخال جميع المعلومات (البريد، كلمة المرور، المستندات، بيانات المركبة) والضغط على "إرسال"
- ✅ يتم إدراج الطلب في جدول `registration_requests` مع `status = 'pending'`
- ✅ يتم توجيه المستخدم مباشرة إلى `UnifiedPendingApprovalScreen` مع تمرير البريد ونوع المستخدم

#### للمتجر (StoreRegistrationScreen → StoreInfoScreen):
- ✅ بعد إدخال جميع المعلومات (البريد، كلمة المرور، بيانات المتجر) والضغط على "إرسال"
- ✅ يتم إدراج الطلب في جدول `registration_requests` مع `status = 'pending'`
- ✅ يتم توجيه المستخدم مباشرة إلى `UnifiedPendingApprovalScreen` مع تمرير البريد ونوع المستخدم

### 2. شاشة تسجيل الدخول (LoginScreen)

#### عند محاولة تسجيل الدخول:
- ✅ **إذا كان الحساب في انتظار الموافقة** (`status = 'pending'`):
  - يتم توجيه المستخدم مباشرة إلى `UnifiedPendingApprovalScreen`
  - لا تظهر رسالة تأكيد، يتم التوجيه مباشرة

- ✅ **إذا كان الحساب مرفوض** (`status = 'rejected'`):
  - يتم حذف الحساب من جميع الجداول (`drivers`, `stores`, `registration_requests`)
  - تظهر رسالة بالسبب مع إشعار أن الحساب تم حذفه
  - يمكن للمستخدم التسجيل مرة أخرى

- ✅ **إذا تمت الموافقة** (`status = 'approved'`):
  - يتم توجيه السائق إلى `DriverDashboard`
  - يتم توجيه المتجر إلى `StoreDashboard`
  - تظهر رسالة ترحيب

### 3. شاشة طلبات التسجيل (RegistrationRequestsScreen)

#### عند الموافقة على الطلب:
- ✅ يتم إنشاء الحساب في الجدول المناسب (`drivers` أو `stores`)
- ✅ يتم تحديث حالة الطلب إلى `approved`
- ✅ معالجة أفضل للأخطاء مع رسائل واضحة

#### عند رفض الطلب:
- ✅ يتم حذف الحساب من جميع الجداول (`drivers`, `stores`, `registration_requests`)
- ✅ يتم تحديث حالة الطلب إلى `rejected`
- ✅ معالجة أفضل للأخطاء مع رسائل واضحة

## الربط مع قاعدة البيانات

### جميع العمليات مربوطة بـ Supabase:
- ✅ إدراج طلبات التسجيل في `registration_requests`
- ✅ إنشاء حسابات في `drivers` و `stores`
- ✅ حذف الحسابات من جميع الجداول
- ✅ تحديث حالات الطلبات
- ✅ التحقق من وجود الحسابات

### الجداول المستخدمة:
1. **registration_requests**: لتخزين طلبات التسجيل المعلقة
2. **drivers**: لتخزين حسابات السائقين المعتمدة
3. **stores**: لتخزين حسابات المتاجر المعتمدة

## تدفق النظام الكامل

### 1. تسجيل حساب جديد:
```
التسجيل → إدخال البيانات → إرسال الطلب → شاشة انتظار الموافقة
```

### 2. تسجيل الدخول:
```
إدخال البيانات → التحقق من الحالة → التوجيه المناسب
```

### 3. إدارة الطلبات:
```
مراجعة الطلب → الموافقة/الرفض → إنشاء/حذف الحساب
```

## المميزات المضافة

1. **التوجيه التلقائي**: لا حاجة لتدخل المستخدم بعد الإرسال النهائي
2. **الحذف التلقائي**: عند الرفض، يتم حذف الحساب من جميع الجداول
3. **معالجة الأخطاء**: رسائل واضحة ومفيدة للمستخدم
4. **الربط الكامل**: جميع العمليات مربوطة بقاعدة البيانات
5. **الأمان**: التحقق من البيانات قبل أي عملية

## ملاحظات تقنية

- جميع العمليات تستخدم Supabase Client
- معالجة الأخطاء محسنة مع رسائل واضحة
- التوجيه يتم عبر React Navigation
- البيانات يتم تمريرها بين الشاشات بشكل آمن 