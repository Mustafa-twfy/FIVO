# النظام الموحد للتسجيل والموافقة

## نظرة عامة

تم إنشاء نظام موحد ومتكامل لإدارة عملية التسجيل والموافقة على المستخدمين (السائقين والمتاجر) مع التعامل الذكي مع الحالات المختلفة.

## المكونات الرئيسية

### 1. شاشة انتظار موافقة موحدة (`UnifiedPendingApprovalScreen.js`)
- **وظيفة موحدة**: تعمل للسائقين والمتاجر
- **تحديث تلقائي**: التحقق من حالة الطلب
- **توجيه ذكي**: توجيه المستخدم للواجهة المناسبة بعد الموافقة
- **رسائل واضحة**: إشعارات مفصلة عن حالة الطلب

### 2. نظام تسجيل دخول محسن (`LoginScreen.js`)
- **تحقق شامل**: فحص جميع الجداول (طلبات التسجيل، السائقين، المتاجر)
- **توجيه ذكي**: توجيه المستخدم للشاشة المناسبة حسب الحالة
- **رسائل واضحة**: إشعارات مفصلة عن سبب عدم القدرة على تسجيل الدخول

### 3. نظام تسجيل محسن
- **تحقق مسبق**: فحص وجود البريد الإلكتروني قبل التسجيل
- **رسائل واضحة**: إشعارات مفصلة عن حالة البريد الإلكتروني
- **توجيه ذكي**: توجيه المستخدم للشاشة المناسبة

## تدفق العمل

### 1. تسجيل مستخدم جديد

#### السائق:
1. **تسجيل الحساب** → التحقق من البريد الإلكتروني
2. **رفع المستندات** → التحقق من البيانات
3. **إدخال بيانات المركبة** → إرسال طلب التسجيل
4. **انتظار الموافقة** → شاشة موحدة لانتظار الموافقة

#### المتجر:
1. **تسجيل الحساب** → التحقق من البريد الإلكتروني
2. **إدخال معلومات المتجر** → إرسال طلب التسجيل
3. **انتظار الموافقة** → شاشة موحدة لانتظار الموافقة

### 2. تسجيل الدخول

#### التحقق التلقائي:
1. **فحص طلبات التسجيل المعلقة**
2. **فحص السائقين المعتمدين**
3. **فحص المتاجر المعتمدة**
4. **توجيه للواجهة المناسبة**

### 3. انتظار الموافقة

#### الميزات:
- **تحديث تلقائي**: فحص حالة الطلب
- **رسائل واضحة**: معلومات مفصلة عن المراحل
- **توجيه ذكي**: الانتقال للواجهة المناسبة بعد الموافقة

## الحالات المختلفة

### 1. البريد الإلكتروني مسجل مسبقاً

#### في طلب تسجيل معلق:
- **رسالة**: "البريد مسجل بالفعل وفي انتظار الموافقة"
- **خيارات**: عرض حالة الطلب أو إلغاء

#### في طلب معتمد:
- **رسالة**: "البريد مسجل وتمت الموافقة عليه"
- **توجيه**: تسجيل الدخول مباشرة

#### في طلب مرفوض:
- **رسالة**: "تم رفض الطلب السابق" مع السبب
- **خيارات**: إعادة التسجيل أو إلغاء

#### في جدول السائقين/المتاجر:
- **رسالة**: "البريد مسجل بالفعل"
- **توجيه**: تسجيل الدخول مباشرة

### 2. تسجيل الدخول

#### طلب معلق:
- **رسالة**: "لديك طلب تسجيل معلق"
- **خيارات**: عرض حالة الطلب أو إلغاء

#### طلب مرفوض:
- **رسالة**: "تم رفض طلب تسجيلك" مع السبب

#### حساب معتمد:
- **توجيه**: الواجهة المناسبة (سائق/متجر/إدارة)

## قاعدة البيانات

### جدول `registration_requests`
```sql
- id: معرف فريد
- email: البريد الإلكتروني
- password: كلمة المرور
- user_type: نوع المستخدم (driver/store)
- name: الاسم
- phone: رقم الهاتف
- address: العنوان (للمتاجر)
- vehicle_type: نوع المركبة (للسائقين)
- status: حالة الطلب (pending/approved/rejected)
- rejection_reason: سبب الرفض
- created_at: تاريخ الإنشاء
- approved_at: تاريخ الموافقة
- rejected_at: تاريخ الرفض
```

### جدول `drivers`
```sql
- id: معرف فريد
- email: البريد الإلكتروني
- password: كلمة المرور
- name: اسم السائق
- phone: رقم الهاتف
- vehicle_type: نوع المركبة
- status: الحالة (approved)
- is_active: نشط
- created_at: تاريخ الإنشاء
```

### جدول `stores`
```sql
- id: معرف فريد
- email: البريد الإلكتروني
- password: كلمة المرور
- name: اسم المتجر
- phone: رقم الهاتف
- address: العنوان
- status: الحالة (approved)
- is_active: نشط
- created_at: تاريخ الإنشاء
```

## الميزات الجديدة

### ✅ نظام موحد
- شاشة واحدة لانتظار الموافقة
- منطق موحد للتحقق
- رسائل واضحة ومتسقة

### ✅ تحقق ذكي
- فحص شامل لجميع الجداول
- رسائل مفصلة عن الحالة
- توجيه ذكي للمستخدم

### ✅ تجربة مستخدم محسنة
- خطوات واضحة
- رسائل مفيدة
- توجيه سلس

### ✅ إدارة أخطاء محسنة
- رسائل خطأ واضحة
- حلول مقترحة
- توجيه للمستخدم

## التطبيق العملي

### 1. سائق جديد:
1. يسجل حساب جديد
2. يرفع المستندات
3. يدخل بيانات المركبة
4. ينتقل لشاشة انتظار الموافقة
5. يتحقق من حالة الطلب
6. بعد الموافقة، يسجل الدخول للواجهة

### 2. متجر جديد:
1. يسجل حساب جديد
2. يدخل معلومات المتجر
3. ينتقل لشاشة انتظار الموافقة
4. يتحقق من حالة الطلب
5. بعد الموافقة، يسجل الدخول للواجهة

### 3. مستخدم مسجل:
1. يحاول تسجيل الدخول
2. النظام يفحص جميع الجداول
3. يوجه للواجهة المناسبة
4. أو يعرض رسالة واضحة

## النتيجة النهائية

✅ نظام موحد ومتكامل
✅ تجربة مستخدم محسنة
✅ إدارة أخطاء شاملة
✅ توجيه ذكي للمستخدمين
✅ رسائل واضحة ومفيدة
✅ دعم كامل لجميع الحالات 