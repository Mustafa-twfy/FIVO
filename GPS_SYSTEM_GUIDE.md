# دليل نظام GPS للمتاجر - توصيل بلس

## نظرة عامة
تم إضافة نظام GPS متكامل للمتاجر في تطبيق توصيل بلس، مما يتيح للسائقين الوصول بسهولة إلى مواقع المتاجر مع إمكانية التنقل والاتصال.

## المميزات الجديدة

### 1. تسجيل موقع المتجر
- **شاشة اختيار الموقع**: تتيح للمتجر تحديد موقعه على الخريطة
- **البحث بالعنوان**: إمكانية البحث عن العنوان والحصول على الإحداثيات
- **الموقع الحالي**: استخدام GPS لتحديد الموقع الحالي
- **تأكيد الموقع**: عرض الإحداثيات والتحقق من دقة الموقع

### 2. رفع المستندات
- **السجل التجاري**: رفع صورة أو PDF من السجل التجاري
- **الشهادة الضريبية**: رفع الشهادة الضريبية أو البطاقة الضريبية
- **الهوية الوطنية**: رفع صورة من هوية صاحب المتجر
- **التحقق من المستندات**: التأكد من وضوح وصحة المستندات

### 3. عرض موقع المتجر للسائقين
- **خريطة تفاعلية**: عرض موقع المتجر على خريطة تفاعلية
- **حساب المسافة**: عرض المسافة بين السائق والمتجر
- **تقدير الوقت**: حساب الوقت المتوقع للوصول
- **التنقل**: فتح تطبيق الخرائط للتنقل
- **الاتصال**: إمكانية الاتصال بالمتجر مباشرة

## الشاشات الجديدة

### 1. StoreLocationScreen
**الوظيفة**: اختيار موقع المتجر على الخريطة
**المميزات**:
- خريطة تفاعلية لاختيار الموقع
- البحث بالعنوان
- استخدام الموقع الحالي
- عرض الإحداثيات
- التحقق من دقة الموقع

### 2. StoreDocumentsScreen
**الوظيفة**: رفع مستندات المتجر
**المميزات**:
- رفع السجل التجاري
- رفع الشهادة الضريبية
- رفع الهوية الوطنية
- التحقق من المستندات
- إرسال طلب التسجيل

### 3. StoreMapScreen
**الوظيفة**: عرض موقع المتجر للسائقين
**المميزات**:
- خريطة تفاعلية
- حساب المسافة والوقت
- أزرار التنقل والاتصال
- معلومات المتجر

## تحديثات قاعدة البيانات

### جدول stores
```sql
ALTER TABLE stores 
ADD COLUMN latitude DECIMAL(10, 8),
ADD COLUMN longitude DECIMAL(11, 8);
```

### جدول registration_requests
```sql
ALTER TABLE registration_requests 
ADD COLUMN latitude DECIMAL(10, 8),
ADD COLUMN longitude DECIMAL(11, 8),
ADD COLUMN commercial_record TEXT,
ADD COLUMN tax_certificate TEXT,
ADD COLUMN id_card TEXT;
```

### الدوال الجديدة
```sql
-- حساب المسافة بين نقطتين
CREATE OR REPLACE FUNCTION calculate_distance(lat1, lon1, lat2, lon2)

-- البحث عن المتاجر القريبة
CREATE OR REPLACE FUNCTION find_nearby_stores(user_lat, user_lon, max_distance)
```

## المكتبات المطلوبة

### expo-location
```bash
expo install expo-location
```
**الاستخدام**: الحصول على الموقع الحالي، حساب المسافات، البحث بالعنوان

### react-native-maps
```bash
expo install react-native-maps
```
**الاستخدام**: عرض الخرائط التفاعلية، تحديد المواقع، إضافة العلامات

### expo-document-picker
```bash
expo install expo-document-picker
```
**الاستخدام**: رفع المستندات (PDF، صور)

## سير العمل الجديد

### تسجيل المتجر
1. **معلومات الحساب**: البريد الإلكتروني وكلمة المرور
2. **معلومات المتجر**: الاسم والعنوان والهاتف
3. **اختيار الموقع**: تحديد الموقع على الخريطة
4. **رفع المستندات**: السجل التجاري، الشهادة الضريبية، الهوية
5. **انتظار الموافقة**: مراجعة الطلب من الإدارة

### استخدام السائق
1. **عرض الطلبات**: رؤية الطلبات المتاحة
2. **اختيار الطلب**: اختيار طلب معين
3. **عرض موقع المتجر**: فتح خريطة موقع المتجر
4. **التنقل**: استخدام GPS للوصول للمتجر
5. **الاتصال**: التواصل مع المتجر عند الحاجة

## الأذونات المطلوبة

### Android
```xml
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.CALL_PHONE" />
```

### iOS
```xml
<key>NSLocationWhenInUseUsageDescription</key>
<string>نحتاج إلى موقعك لعرض المتاجر القريبة والتنقل</string>
<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>نحتاج إلى موقعك لعرض المتاجر القريبة والتنقل</string>
```

## الأمان والخصوصية

### حماية البيانات
- تشفير إحداثيات GPS
- حماية معلومات المتجر
- التحقق من صحة المستندات
- مراجعة طلبات التسجيل

### أذونات الموقع
- طلب الإذن قبل استخدام الموقع
- شرح سبب الحاجة للموقع
- إمكانية إلغاء الإذن لاحقاً

## الدعم الفني

### المشاكل الشائعة
1. **عدم ظهور الموقع**: التحقق من إعدادات GPS
2. **خطأ في الخريطة**: التحقق من اتصال الإنترنت
3. **فشل رفع المستندات**: التحقق من حجم الملف والصيغة

### الحلول
- إعادة تشغيل التطبيق
- التحقق من الأذونات
- تحديث التطبيق
- التواصل مع الدعم الفني

## التطوير المستقبلي

### المميزات المقترحة
- **التنبيهات الجغرافية**: إشعارات عند الاقتراب من المتجر
- **تتبع الطلبات**: تتبع مسار التوصيل في الوقت الفعلي
- **تحليل البيانات**: إحصائيات المسافات والأوقات
- **تحسين المسارات**: اقتراح أفضل الطرق

### التحسينات التقنية
- **تخزين محلي**: حفظ المواقع المفضلة
- **مزامنة البيانات**: تحديث المواقع تلقائياً
- **تحسين الأداء**: تحسين سرعة تحميل الخرائط
- **دعم متعدد اللغات**: إضافة لغات أخرى

## الخلاصة

نظام GPS للمتاجر يوفر تجربة شاملة ومتكاملة لجميع المستخدمين:
- **المتاجر**: تسجيل سهل مع تحديد دقيق للموقع
- **السائقين**: وصول سريع ودقيق للمتاجر
- **الإدارة**: مراقبة وتحكم أفضل في العمليات

النظام مصمم ليكون سهل الاستخدام وآمناً ومتطوراً ليلبي احتياجات جميع الأطراف في نظام التوصيل. 